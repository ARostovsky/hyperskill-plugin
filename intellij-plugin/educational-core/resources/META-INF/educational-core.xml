<idea-plugin xmlns:xi="http://www.w3.org/2001/XInclude">
  <!--suppress PluginXmlValidity -->
  <dependencies>
    <plugin id="com.intellij.modules.lang"/>
    <!-- The vcs module is needed to be sure that IgnoreFileType, PatternCache exist which are used for .courseignore support -->
    <plugin id="com.intellij.modules.vcs"/>
  </dependencies>

  <resource-bundle>messages.EduCoreBundle</resource-bundle>

  <applicationListeners>
    <listener class="com.jetbrains.edu.learning.EduDynamicPluginListener"
              topic="com.intellij.ide.plugins.DynamicPluginListener"/>
    <listener class="com.jetbrains.edu.learning.InitializationListener" topic="com.intellij.ide.AppLifecycleListener"/>
    <listener class="com.jetbrains.edu.learning.InitializationListener" topic="com.intellij.ide.plugins.DynamicPluginListener"/>
    <listener class="com.jetbrains.edu.learning.RecentPreviewCourseListener"
              topic="com.intellij.openapi.project.ProjectManagerListener"/>
    <listener class="com.jetbrains.edu.learning.RecentPreviewCourseListener"
              topic="com.intellij.ide.AppLifecycleListener"/>
  </applicationListeners>

  <projectListeners>
    <listener class="com.jetbrains.edu.learning.checker.FixModuleForRunConfigurationsListener"
              topic="com.intellij.execution.RunManagerListener"/>
    <listener class="com.jetbrains.edu.learning.checker.PreventRunConfigurationsRenameListener"
              topic="com.intellij.execution.RunManagerListener"/>
    <listener class="com.jetbrains.edu.learning.checker.FixModuleForRunConfigurationsListener"
              topic="com.intellij.openapi.roots.ModuleRootListener"/>
    <listener class="com.jetbrains.edu.learning.yaml.YamlLoadingErrorManager$Listener"
              topic="com.jetbrains.edu.learning.yaml.YamlListener"/>
    <listener class="com.jetbrains.edu.learning.taskToolWindow.EduFileEditorManagerListener"
              topic="com.intellij.openapi.fileEditor.FileEditorManagerListener"/>
    <listener class="com.jetbrains.edu.learning.taskToolWindow.EduFileEditorManagerListener"
              topic="com.intellij.openapi.fileEditor.FileEditorManagerListener$Before"/>
    <listener class="com.jetbrains.edu.learning.storage.LearningObjectsPersister"
              topic="com.jetbrains.edu.learning.CourseSetListener"/>
  </projectListeners>

  <extensionPoints>
    <extensionPoint qualifiedName="HyperskillEducational.configurator"
                    beanClass="com.jetbrains.edu.learning.configuration.EducationalExtensionPoint"
                    dynamic="true">
      <with attribute="implementationClass" implements="com.jetbrains.edu.learning.configuration.EduConfigurator"/>
    </extensionPoint>
    <extensionPoint qualifiedName="HyperskillEducational.compatibilityProvider"
                    beanClass="com.jetbrains.edu.learning.compatibility.CourseCompatibilityProviderEP"
                    dynamic="true">
      <with attribute="implementationClass" implements="com.jetbrains.edu.learning.compatibility.CourseCompatibilityProvider"/>
    </extensionPoint>

    <extensionPoint qualifiedName="HyperskillEducational.remoteTaskChecker"
                    interface="com.jetbrains.edu.learning.checker.remote.RemoteTaskChecker"
                    dynamic="true"/>
    <extensionPoint qualifiedName="HyperskillEducational.checkListener"
                    interface="com.jetbrains.edu.learning.checker.CheckListener"
                    dynamic="true"/>
    <extensionPoint qualifiedName="HyperskillEducational.submissionsProvider"
                    interface="com.jetbrains.edu.learning.submissions.provider.SubmissionsProvider"
                    dynamic="true"/>
    <extensionPoint qualifiedName="HyperskillEducational.communitySubmissionsProvider"
                    interface="com.jetbrains.edu.learning.submissions.provider.CommunitySubmissionsProvider"
                    dynamic="true"/>
    <extensionPoint qualifiedName="HyperskillEducational.optionsProvider"
                    beanClass="com.intellij.openapi.options.ConfigurableEP"
                    dynamic="true">
      <with attribute="instance" implements="com.jetbrains.edu.learning.settings.OptionsProvider"/>
    </extensionPoint>

    <extensionPoint qualifiedName="HyperskillEducational.coursesPlatformProviderFactory"
                    interface="com.jetbrains.edu.learning.newproject.ui.CoursesPlatformProviderFactory"
                    dynamic="true"/>
    <extensionPoint qualifiedName="HyperskillEducational.pathMacroProvider"
                    interface="com.jetbrains.edu.learning.courseGeneration.macro.EduMacroProvider"
                    dynamic="true"/>

    <extensionPoint qualifiedName="HyperskillEducational.postToGithub"
                    interface="com.jetbrains.edu.learning.github.PostToGithubActionProvider"
                    dynamic="true"/>

    <extensionPoint qualifiedName="HyperskillEducational.taskNavigationExtension"
                    interface="com.jetbrains.edu.learning.navigation.TaskNavigationExtension"
                    dynamic="true"/>

    <extensionPoint qualifiedName="HyperskillEducational.revertTaskExtension"
                    interface="com.jetbrains.edu.learning.actions.RevertTaskAction$RevertTaskExtension"
                    dynamic="true"/>
    <extensionPoint qualifiedName="HyperskillEducational.remoteEnvHelper"
                    interface="com.jetbrains.edu.learning.RemoteEnvHelper"
                    dynamic="true"/>

    <extensionPoint qualifiedName="HyperskillEducational.courseViewPaneCustomization"
                    interface="com.jetbrains.edu.learning.projectView.CourseViewPaneCustomization"
                    dynamic="true"/>
    <extensionPoint qualifiedName="HyperskillEducational.studyItemRefactoringHandler"
                    interface="com.jetbrains.edu.coursecreator.handlers.StudyItemRefactoringHandler"
                    dynamic="true"/>
    <extensionPoint qualifiedName="HyperskillEducational.hyperskillCourseCreator"
                    interface="com.jetbrains.edu.learning.stepik.hyperskill.courseGeneration.HyperskillCourseCreator"
                    dynamic="true"/>
    <extensionPoint qualifiedName="HyperskillEducational.courseMetadataProcessor"
                    interface="com.jetbrains.edu.learning.newproject.CourseMetadataProcessor"
                    dynamic="true"/>
  </extensionPoints>

  <actions>
    <action id="Educational.Check" class="com.jetbrains.edu.learning.actions.CheckAction"/>
    <action id="Educational.Run"
            class="com.jetbrains.edu.learning.actions.RunTaskAction"
            icon="AllIcons.Actions.Execute"/>
    <action id="Educational.AssignRunConfigurationToTask"
            class="com.jetbrains.edu.learning.actions.AssignRunConfigurationToTask">
      <add-to-group group-id="RunConfiguration.Group" anchor="before" relative-to-action="DeleteRunConfiguration"/> <!-- top right -->
    </action>
    <action id="Educational.Retry" class="com.jetbrains.edu.learning.actions.RetryAction"/>
    <action id="Educational.PreviousTask"
            class="com.jetbrains.edu.learning.actions.PreviousTaskAction"
            icon="AllIcons.Actions.Back"/>
    <action id="Educational.NextTask"
            class="com.jetbrains.edu.learning.actions.NextTaskAction"
            icon="AllIcons.Actions.Forward"/>
    <action id="Educational.RefreshTask"
            class="com.jetbrains.edu.learning.actions.RevertTaskAction"
            icon="com.jetbrains.edu.EducationalCoreIcons.Actions.ResetTask"/>
    <action id="Educational.LeaveFeedbackAction"
            class="com.jetbrains.edu.learning.actions.LeaveFeedbackAction"
            icon="com.jetbrains.edu.EducationalCoreIcons.Actions.CommentTask"/>
    <action id="Educational.OpenTaskOnSiteAction" class="com.jetbrains.edu.learning.actions.OpenTaskOnSiteAction"/>
    <action id="Educational.CompareWithAnswer"
            class="com.jetbrains.edu.learning.actions.CompareWithAnswerAction"
            icon="AllIcons.Actions.Diff"/>
    <action id="Educational.SwitchTaskDescriptionPanel" class="com.jetbrains.edu.learning.actions.SwitchTaskPanelAction">
    </action>

    <!-- IMPORTANT: don't change the action id, it's used in monorepo-->
    <action id="Educational.BrowseCourses" class="com.jetbrains.edu.learning.newproject.BrowseCoursesAction"/>

    <action id="Educational.ToggleRestServices"
            class="com.jetbrains.edu.learning.actions.ToggleRestServicesAction"
            internal="true"/>

    <action id="LessonCard-left" class="com.intellij.openapi.actionSystem.EmptyAction" use-shortcut-of="EditorLeft"/>
    <action id="LessonCard-right" class="com.intellij.openapi.actionSystem.EmptyAction" use-shortcut-of="EditorRight"/>

    <group id="Educational.LearnAndTeachFileMenu"
           class="com.jetbrains.edu.learning.newproject.LearnAndTeachFileMenuGroup"
           popup="true"
           icon="com.jetbrains.edu.EducationalCoreIcons.Actions.EduCourse">
      <reference ref="Educational.BrowseCourses"/>
      <add-to-group group-id="FileOpenGroup" relative-to-action="OpenFile" anchor="after"/>
    </group>
    <action id="Educational.Student.ApplyCode"
            class="com.jetbrains.edu.learning.actions.ApplyCodeAction"
            icon="com.jetbrains.edu.EducationalCoreIcons.Actions.ApplyCode">
      <add-to-group group-id="Diff.ViewerToolbar"/>
      <keyboard-shortcut
          keymap="$default"
          first-keystroke="control alt shift A"
      />
    </action>
    <action id="Educational.Educator.OpenEducatorHelp"
            class="com.jetbrains.edu.coursecreator.ui.CCOpenEducatorHelp"/>
    <group id="Educational.CourseView.SecondaryActions">
      <action id="Educational.HideSolvedLessons"
              class="com.jetbrains.edu.learning.projectView.CourseViewPane$HideSolvedLessonsAction"/>
    </group>

    <!-- Actions located in the right corner of the Course View header -->
    <group id="Educational.CourseView.Header.Right">
      <reference ref="Educational.Educator.OpenEducatorHelp"/>
    </group>

    <group id="Educational.CheckPanel.Left">
      <reference ref="Educational.Run"/>
    </group>

    <group id="Educational.CheckPanel.Right">
      <reference ref="Educational.RefreshTask"/>
      <reference ref="Educational.LeaveFeedbackAction"/>
    </group>

    <!-- Actions located in the right corner of Task tool window -->
    <group id="Educational.TaskToolWindowView.TitleActions">
      <reference ref="Educational.PreviousTask"/>
      <reference ref="Educational.NextTask"/>
    </group>
  </actions>

  <extensions defaultExtensionNs="com.intellij">
    <applicationService serviceInterface="com.jetbrains.edu.learning.EduBrowser"
                        serviceImplementation="com.jetbrains.edu.learning.EduBrowser"
                        testServiceImplementation="com.jetbrains.edu.learning.MockEduBrowser"/>

    <applicationService serviceImplementation="com.jetbrains.edu.coursecreator.settings.CCSettings"/>

    <applicationService serviceInterface="com.jetbrains.edu.learning.courseGeneration.ProjectOpener"
                        serviceImplementation="com.jetbrains.edu.learning.courseGeneration.ProjectOpenerImpl"
                        testServiceImplementation="com.jetbrains.edu.learning.MockProjectOpener"/>

    <projectService serviceInterface="com.jetbrains.edu.learning.taskToolWindow.ui.TaskToolWindowView"
                    serviceImplementation="com.jetbrains.edu.learning.taskToolWindow.ui.TaskToolWindowViewImpl"
                    testServiceImplementation="com.jetbrains.edu.learning.taskToolWindow.ui.MockTaskToolWindowView"/>
    <projectService serviceInterface="com.jetbrains.edu.learning.checker.details.CheckDetailsView"
                    serviceImplementation="com.jetbrains.edu.learning.checker.details.CheckDetailsViewImpl"
                    headlessImplementation="com.jetbrains.edu.learning.checker.details.MockCheckDetailsView"
                    testServiceImplementation="com.jetbrains.edu.learning.checker.details.MockCheckDetailsView"/>
    <projectService serviceInterface="com.jetbrains.edu.learning.framework.FrameworkLessonManager"
                    serviceImplementation="com.jetbrains.edu.learning.framework.impl.FrameworkLessonManagerImpl"/>

    <!-- Courseignore lang -->
    <fileType language="CourseIgnore" fileNames=".courseignore" fieldName="INSTANCE" name="CourseIgnore file"
              implementationClass="com.jetbrains.edu.coursecreator.courseignore.CourseIgnoreFileType"/>
    <lang.parserDefinition language="CourseIgnore"
                           implementationClass="com.intellij.openapi.vcs.changes.ignore.lang.IgnoreParserDefinition"/>
    <codeInsight.lineMarkerProvider language="CourseIgnore"
                                    implementationClass="com.intellij.openapi.vcs.changes.ignore.codeInsight.IgnoreDirectoryMarkerProvider"/>
    <lang.braceMatcher language="CourseIgnore" implementationClass="com.intellij.openapi.vcs.changes.ignore.lang.IgnoreBraceMatcher"/>
    <lang.commenter language="CourseIgnore" implementationClass="com.intellij.openapi.vcs.changes.ignore.lang.IgnoreCommenter"/>
    <!--END of Courseignore lang-->

    <postStartupActivity implementation="com.jetbrains.edu.learning.EduProjectActivity"/>

    <registryKey key="edu.task.description.update.delay"
                 description="The delay in ms before loading page by Task Description view. \nRequires project reopening"
                 defaultValue="300"/>

    <applicationConfigurable groupId="tools" instance="com.jetbrains.edu.learning.settings.EduConfigurable"
                             id="Educational"
                             key="settings.education" bundle="messages.EduCoreBundle"/>

    <registryKey key="edu.marketplace.solutions.sharing.prompt.default.delay"
                 description="Delay of prompting second banner (in millis). Default value is equal to 14 days."
                 defaultValue="1209600000"/>

    <registryKey key="edu.marketplace.PostMarketplaceProjectToGitHub.completion.condition"
                 description="Course completion percentage, which should prompt the student to publish the project on GitHub"
                 defaultValue="80"/>

    <registryKey key="edu.learning.objects.storage.type"
                 description="Controls the way the original author data is stored in the project. This setting does not affect existing course projects, it affects only newly created projects"
                 defaultValue="[SQLite*|YAML]"/>

    <toolWindow id="Task" anchor="right" order="first"
                factoryClass="com.jetbrains.edu.learning.taskToolWindow.ui.TaskToolWindowFactory"
                icon="com.jetbrains.edu.EducationalCoreIcons.TaskToolWindow.CourseToolWindow"/>
    <toolWindow id="Educational.CheckDetails" anchor="bottom" canCloseContents="true" doNotActivateOnStart="true"
                factoryClass="com.jetbrains.edu.learning.checker.details.CheckDetailsToolWindowFactory"
                icon="com.jetbrains.edu.EducationalCoreIcons.CheckPanel.CheckDetailsToolWindow"/>

    <!-- placeholders -->
    <editorFactoryListener implementation="com.jetbrains.edu.learning.editor.EduEditorFactoryListener"/>
    <additionalTextAttributes scheme="Default" file="colorScheme/EduDefault.xml"/>
    <additionalTextAttributes scheme="Darcula" file="colorScheme/EduDarcula.xml"/>
    <registryKey key="edu.placeholder.highlighting.pass" defaultValue="false" restartRequired="true"
                 description="Render answer placeholders in Hyperskill Academy courses using highlighting API"/>

    <!-- should be last, otherwise project tree will be changed with GradleTreeStructureProvider -->
    <highlightErrorFilter implementation="com.jetbrains.edu.learning.editor.EduHighlightErrorFilter"/>

    <!-- Rename -->
    <renamePsiElementProcessor implementation="com.jetbrains.edu.learning.handlers.rename.SectionRenameProcessor" order="first"/>
    <renamePsiElementProcessor implementation="com.jetbrains.edu.learning.handlers.rename.LessonRenameProcessor" order="first"/>
    <renamePsiElementProcessor implementation="com.jetbrains.edu.learning.handlers.rename.TaskRenameProcessor" order="first"/>
    <renamePsiElementProcessor implementation="com.jetbrains.edu.learning.handlers.rename.EduTaskFileRenameProcessor" order="first"/>

    <!-- Move -->
    <refactoring.moveHandler implementation="com.jetbrains.edu.learning.handlers.EduMoveDelegate" order="first"/>

    <!-- Notifications   -->
    <editorNotificationProvider implementation="com.jetbrains.edu.learning.stepik.UpdateCourseNotificationProvider"/>
    <editorNotificationProvider implementation="com.jetbrains.edu.learning.editor.EduTaskFileNotificationProvider"/>
    <editorNotificationProvider implementation="com.jetbrains.edu.learning.yaml.YamlConfigNotificationProvider"/>

    <!-- com.jetbrains.edu.learning.notification.EduNotificationManager.JETBRAINS_ACADEMY_GROUP_ID -->
    <notificationGroup id="Hyperskill Academy" displayType="BALLOON"
                       bundle="messages.EduCoreBundle" key="notification.group.edu.tools"/>

    <!--suppress PluginXmlValidity -->
    <applicationService serviceImplementation="com.jetbrains.edu.learning.EduSettings"/>
    <httpRequestHandler implementation="com.jetbrains.edu.learning.taskToolWindow.ui.EduToolsResourcesRequestHandler"/>

    <registryKey key="edu.course.update.check.interval"
                 description="Sets is course up to date check interval in seconds"
                 defaultValue="18000"/>

    <!--for educators-->
    <xml.xmlSuppressionProvider
        implementation="com.jetbrains.edu.coursecreator.taskDescription.ShortcutInTaskDescriptionSuppressionProvider"/>

    <!-- Rename -->
    <renamePsiElementProcessor implementation="com.jetbrains.edu.coursecreator.handlers.rename.CCDescriptionFileRenameProcessor"
                               order="first"/>

    <!-- Move -->
    <refactoring.moveHandler implementation="com.jetbrains.edu.coursecreator.handlers.move.CCSectionMoveHandlerDelegate"
                             order="first"/>
    <refactoring.moveHandler implementation="com.jetbrains.edu.coursecreator.handlers.move.CCLessonMoveHandlerDelegate"
                             order="first"/>
    <refactoring.moveHandler implementation="com.jetbrains.edu.coursecreator.handlers.move.CCTaskMoveHandlerDelegate"
                             order="first"/>

    <highlightErrorFilter implementation="com.jetbrains.edu.coursecreator.CCHighlightErrorFilter"/>

    <projectViewPane implementation="com.jetbrains.edu.learning.projectView.CourseViewPane"/>

    <experimentalFeature id="edu.course.creator.split.editor" percentOfUsers="100" internalFeature="true">
      <description>Enables previous task view for guided projects</description>
    </experimentalFeature>
    <defaultLiveTemplates file="liveTemplates/hint.xml"/>
    <editorNotificationProvider implementation="com.jetbrains.edu.learning.yaml.GeneratedRemoteInfoNotificationProvider"/>
    <registryKey key="edu.course.creator.solve.all"
                 description="Enables `Solve All Tasks Before` action"
                 defaultValue="false"/>

    <writingAccessProvider implementation="com.jetbrains.edu.learning.editor.EditableFileProvider"/>

    <experimentalFeature id="edu.course.sql" percentOfUsers="100" internalFeature="true">
      <description>Enables support for SQL courses</description>
    </experimentalFeature>
    <experimentalFeature id="edu.course.update.new" percentOfUsers="100">
      <description>Enable the new course update functionality to provide more efficient course updates</description>
    </experimentalFeature>
    <experimentalFeature id="edu.educator.help" percentOfUsers="100">
      <description>Open educator help for newly created CC courses; add Help button to the toolbar above course view</description>
    </experimentalFeature>

    <registryKey key="edu.course.creator.fl.sync.changes.merging.timespan"
                 description="The delay in ms before task file synchronization in the guided project for Course Creator.\nChanging the field requires reopening the project"
                 defaultValue="1000"/>

    <iconMapper mappingFile="EduToolsIconMappings.json"/>
    <themeMetadataProvider path="JetBrainsAcademyPlugin.themeMetadata.json"/>

    <coursesStorageProvider implementation="com.jetbrains.edu.learning.newproject.coursesStorage.JetBrainsAcademyCoursesStorageProvider"/>

    <registryKey key="edu.network.request.assertion.policy"
                 description="Assertion policy for network requests from EDT in Hyperskill Academy plugin"
                 defaultValue="[OFF|LOG_ERROR*|EXCEPTION]"/>
  </extensions>

  <extensions defaultExtensionNs="HyperskillEducational">
    <!-- Only for development purposes -->
    <configurator language="TEXT" implementationClass="com.jetbrains.edu.learning.configuration.PlainTextConfigurator"/>
    <configurator language="TEXT" courseType="Hyperskill"
                  implementationClass="com.jetbrains.edu.learning.stepik.hyperskill.PlainTextHyperskillConfigurator"/>

    <checkListener implementation="com.jetbrains.edu.coursecreator.validation.ValidationCheckListener"/>
    <coursesPlatformProviderFactory id="JetBrainsAcademy" order="first"
                                    implementation="com.jetbrains.edu.learning.stepik.hyperskill.newProjectUI.HyperskillPlatformProviderFactory"/>

    <!-- Course compatibility providers   -->
    <compatibilityProvider language="JAVA"
                           implementationClass="com.jetbrains.edu.learning.compatibility.JCourseCompatibilityProvider"/>
    <compatibilityProvider language="kotlin"
                           implementationClass="com.jetbrains.edu.learning.compatibility.KtCourseCompatibilityProvider"/>
    <compatibilityProvider language="Scala"
                           environment="Gradle"
                           implementationClass="com.jetbrains.edu.learning.compatibility.ScalaGradleCourseCompatibilityProvider"/>
    <!--need to register without environment to work with Hyperskill courses-->
    <compatibilityProvider language="Scala"
                           implementationClass="com.jetbrains.edu.learning.compatibility.ScalaGradleCourseCompatibilityProvider"/>
    <compatibilityProvider language="Scala"
                           environment="sbt"
                           implementationClass="com.jetbrains.edu.learning.compatibility.ScalaSbtCourseCompatibilityProvider"/>
    <compatibilityProvider language="kotlin"
                           environment="Android"
                           implementationClass="com.jetbrains.edu.learning.compatibility.AndroidCourseCompatibilityProvider"/>
    <compatibilityProvider language="Python"
                           implementationClass="com.jetbrains.edu.learning.compatibility.PyCourseCompatibilityProvider"/>
    <compatibilityProvider language="Python"
                           environment="unittest"
                           implementationClass="com.jetbrains.edu.learning.compatibility.PyCourseCompatibilityProvider"/>
    <compatibilityProvider language="JavaScript"
                           implementationClass="com.jetbrains.edu.learning.compatibility.JsCourseCompatibilityProvider"/>
    <compatibilityProvider language="Rust"
                           implementationClass="com.jetbrains.edu.learning.compatibility.RsCourseCompatibilityProvider"/>
    <compatibilityProvider language="go"
                           implementationClass="com.jetbrains.edu.learning.compatibility.GoCourseCompatibilityProvider"/>
    <compatibilityProvider language="PHP"
                           implementationClass="com.jetbrains.edu.learning.compatibility.PhpCourseCompatibilityProvider"/>
    <compatibilityProvider language="SQL"
                           implementationClass="com.jetbrains.edu.learning.compatibility.SqlGradleCourseCompatibilityProvider"/>
    <compatibilityProvider language="Shell Script"
                           implementationClass="com.jetbrains.edu.learning.compatibility.ShellCourseCompatibilityProvider"/>

    <!--educator-->
    <optionsProvider instance="com.jetbrains.edu.coursecreator.settings.CCOptions"/>

    <pathMacroProvider implementation="com.jetbrains.edu.learning.checker.TaskRunConfigurationPathMacroProvider"/>

    <courseMetadataProcessor implementation="com.jetbrains.edu.learning.statistics.metadata.CoursePageExperimentMetadataProcessor"/>
    <courseMetadataProcessor implementation="com.jetbrains.edu.learning.statistics.metadata.EntryPointMetadataProcessor"/>
  </extensions>

  <xi:include href="/META-INF/Hyperskill.xml" xpointer="xpointer(/idea-plugin/*)"/>
</idea-plugin>
